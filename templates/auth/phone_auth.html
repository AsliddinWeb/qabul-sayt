{% load static %}
<!doctype html>
<html class="no-js" lang="uz">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Kirish - Ta'lim Tizimi</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'assets/images/logo/favicon.svg' %}">
    <!-- CSS here -->
    <link rel="stylesheet" href="{% static 'assets/css/vendor/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendor/animate.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/swiper.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendor/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendor/fontawesome-pro.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/nouislider.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendor/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/vendor/spacing.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/apexcharts.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">
</head>

<body>

    <!-- preloader start -->
    <div id="loading">
        <div id="loading-center">
            <div id="loading-center-absolute">
                <div class="bd-preloader-content">
                    <div class="bd-preloader-logo">
                        <div class="bd-preloader-circle">
                            <svg width="190" height="190" viewBox="0 0 380 380" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle stroke="#F5F5F5" cx="190" cy="190" r="180" stroke-width="6" stroke-linecap="round">
                                </circle>
                                <circle stroke="red" cx="190" cy="190" r="180" stroke-width="6" stroke-linecap="round">
                                </circle>
                            </svg>
                        </div>
                        <img src="{% static 'assets/images/logo/preloader-icon.png' %}" alt="">
                    </div>
                    <p class="bd-preloader-subtitle">Yuklanmoqda...</p>
                </div>
            </div>
        </div>
    </div>
    <!-- preloader end -->

    <!-- Body main wrapper start -->
    <main>

        <!-- sign form area start -->
        <section class="bd-authentication-cover-main ">
            <div class="row h100vh mx-0">
                <div class="col-xxl-6 col-xl-5 col-lg-12 d-xl-block d-none px-0">
                    <div class="bd-authentication-cover overflow-hidden" style="background-image: url('{% static 'assets/images/new/bg-xiu.jpg' %}');">
                        <div class="bd-authentication-cover-content d-flex-center">
                            <div class="bd-section-title-wrapper">
                                <h2 class="bd-section-title mb-20">Xush kelibsiz!</h2>
                                <h5 class="bd-section-paragraph">Qabul tizimiga kirish uchun telefon raqamingizni kiriting.</h5>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-6 col-xl-7">
                    <div class="row justify-content-center align-items-center h100p">
                        <div class="col-xxl-7 col-xl-9 col-lg-6 col-md-6 col-sm-8 col-12">
                            <div class="bd-authentication-form-wrapper">
                                <div class="bd-authentication-form-logo">
                                    <a href="/"><img src="{% static 'assets/images/logo/logo.svg' %}" alt="logo"></a>
                                </div>
                                <h3 class="title mb-10">Tizimga kirish</h3>
                                <p class="subtitle">Telefon raqamingizni kiriting</p>

                                <!-- Django messages -->
                                {% if messages %}
                                    {% for message in messages %}
                                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                            {{ message }}
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        </div>
                                    {% endfor %}
                                {% endif %}

                                <!-- Form errors -->
                                {% if form.non_field_errors %}
                                    <div class="alert alert-danger">
                                        {% for error in form.non_field_errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <form method="POST" action="{% url 'users:phone_auth' %}" id="phone-form">
                                    {% csrf_token %}

                                    <!-- Telefon raqami -->
                                    <div class="form-input-box mb-20">
                                        <div class="form-input-title">
                                            <label for="phone">Telefon raqami <span>*</span></label>
                                        </div>
                                        <div class="form-input">
                                            {{ form.phone }}
                                            {% if form.phone.errors %}
                                                <div class="text-danger small mt-1">
                                                    {{ form.phone.errors.0 }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <small class="text-muted">
                                            Masalan: +998 90 123 45 67
                                        </small>
                                    </div>

                                    <div class="bd-sign-btn">
                                        <button type="submit" class="bd-btn btn-primary w-100" id="submit-btn">
                                            <span class="btn-text">
                                                <i class="fa fa-paper-plane me-2"></i>
                                                SMS kod yuborish
                                            </span>
                                            <span class="btn-loading" style="display: none;">
                                                <i class="fa fa-spinner fa-spin me-2"></i>
                                                Yuborilmoqda...
                                            </span>
                                        </button>
                                    </div>
                                </form>

                                <div class="text-center mt-4 text-muted">
                                    <p class="mb-2">
                                        <i class="fa fa-info-circle"></i>
                                        Telefon raqamingizga SMS kod yuboriladi
                                    </p>
                                    <p>
                                        Agar ro'yxatdan o'tmagan bo'lsangiz, avtomatik ro'yxatdan o'tasiz
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- sign form area end -->

    </main>
    <!-- Body main wrapper end -->

    <!-- back to top -->
    <div class="backtotop-wrap cursor-pointer">
        <svg class="backtotop-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
            <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
        </svg>
    </div>
    <!-- Backtotop end -->

    <!-- JS here -->
    <script src="{% static 'assets/js/vendor/jquery-3.7.1.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/waypoints.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/swiper.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/wow.js' %}"></script>
    <script src="{% static 'assets/js/vendor/magnific-popup.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/nice-select.min.js' %}"></script>
    <script src="{% static 'assets/js/vendor/ajax-form.js' %}"></script>
    <script src="{% static 'assets/js/plugins/easypie.js' %}"></script>
    <script src="{% static 'assets/js/vendor/purecounter.js' %}"></script>
    <script src="{% static 'assets/js/plugins/nouislider.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/apexcharts.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/typed.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>

    <!-- Custom scripts -->
    <script>
        $(document).ready(function() {
            // Telefon input
            const phoneInput = $('#phone');
            const form = $('#phone-form');
            const submitBtn = $('#submit-btn');

            // Telefon raqam formatlash
            phoneInput.on('input', function(e) {
                let value = e.target.value;

                // Avval barcha bo'sh joylarni olib tashlash
                value = value.replace(/\s/g, '');

                // + belgisini saqlab, faqat raqamlarni olish
                let hasPlus = value.startsWith('+');
                let numbers = value.replace(/\D/g, '');

                // Agar + bo'lmasa va raqamlar bor bo'lsa
                if (!hasPlus && numbers) {
                    // 998 bilan boshlanmasa qo'shish
                    if (!numbers.startsWith('998')) {
                        numbers = '998' + numbers;
                    }
                }

                // Maksimal uzunlik (998 + 9 raqam = 12)
                if (numbers.length > 12) {
                    numbers = numbers.slice(0, 12);
                }

                // Formatlash
                let formatted = '';

                if (numbers.length > 0) {
                    // Format: +998 90 123 45 67
                    formatted = '+' + numbers.slice(0, 3); // +998

                    if (numbers.length > 3) {
                        formatted += ' ' + numbers.slice(3, 5); // 90
                    }

                    if (numbers.length > 5) {
                        formatted += ' ' + numbers.slice(5, 8); // 123
                    }

                    if (numbers.length > 8) {
                        formatted += ' ' + numbers.slice(8, 10); // 45
                    }

                    if (numbers.length > 10) {
                        formatted += ' ' + numbers.slice(10, 12); // 67
                    }

                    e.target.value = formatted;
                } else if (hasPlus) {
                    e.target.value = '+';
                } else {
                    e.target.value = '';
                }
            });

            // Faqat raqam va + kiritish mumkin
            phoneInput.on('keypress', function(e) {
                const char = String.fromCharCode(e.which);
                const currentValue = e.target.value;

                // + faqat boshida bo'lishi mumkin
                if (char === '+' && currentValue.length > 0) {
                    e.preventDefault();
                    return;
                }

                // Enter tugmasi
                if (e.which === 13) {
                    e.preventDefault();
                    form.submit();
                    return;
                }

                // Faqat raqamlar va +
                if (!/[0-9+]/.test(char)) {
                    e.preventDefault();
                }
            });

            // Paste qilganda
            phoneInput.on('paste', function(e) {
                e.preventDefault();
                const pasteData = (e.originalEvent.clipboardData || window.clipboardData).getData('text');
                const cleaned = pasteData.replace(/[^\d+]/g, '');
                phoneInput.val(cleaned).trigger('input');
            });

            // Form yuborilganda
            form.on('submit', function(e) {
                // Loading ko'rsatish
                submitBtn.prop('disabled', true);
                submitBtn.find('.btn-text').hide();
                submitBtn.find('.btn-loading').show();
            });

            // Fokus
            phoneInput.focus();
        });
    </script>
</body>

</html>