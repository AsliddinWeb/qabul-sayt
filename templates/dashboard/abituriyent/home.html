{% extends 'dashboard/abituriyent/base.html' %}
{% load static %}

{% block main_content %}
<div class="col-xl-9 col-lg-9 col-md-8 order-1 order-xl-2">
    <div class="bd-dashboard-inner">
        <div class="bd-dashboard-status-box mb-30">
            <div class="bd-dashboard-title-inner">
                <h4 class="bd-dashboard-title">Hujjatlar holati</h4>
            </div>
            <div class="container p-0">
                <div class="row gy-30 justify-content-center">
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                        <div class="bd-counter-wrapper bd-counter-style-six">
                            <div class="bd-counter-item">
                                <div class="bd-counter-content">
                                    <span class="bd-counter-icon bg-two"><i class="fa-solid fa-id-card"></i></span>
                                    <h4>
                                        <span>Passport</span>
                                    </h4>
                                    {% if profile %}
                                    <p class="text-success">{{ profile.passport_series }}</p>
                                    {% else %}
                                    <p class="text-warning">Passport kiritilmagan</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                        <div class="bd-counter-wrapper bd-counter-style-six">
                            <div class="bd-counter-item">
                                <div class="bd-counter-content">
                                    <span class="bd-counter-icon bg-two"><i
                                            class="fa-solid fa-graduation-cap"></i></span>

                                    <h4>
                                        <span>Diplom</span>
                                    </h4>
                                    {% if profile and user.diplom or profile and user.transfer_diplom %}
                                    {% if user.diplom %}
                                    <p>{{ user.diplom.university_name }}</p>
                                    {% elif user.transfer_diplom %}
                                    <p>{{ user.transfer_diplom.university_name }}</p>
                                    {% endif %}
                                    {% else %}
                                    <p class="text-warning">Diplom ma'lumotlari topilmadi</p>
                                    {% endif %}

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                        <div class="bd-counter-wrapper bd-counter-style-six">
                            <div class="bd-counter-item">
                                <div class="bd-counter-content">
                                    <span class="bd-counter-icon bg-two"><i
                                            class="fa-solid fa-clipboard-check"></i></span>
                                    <h4>
                                        <span>Ariza</span>
                                    </h4>
                                    {% if profile and user.application %}
                                    <p>{{ user.application.status }}</p>
                                    {% else %}
                                    <p class="text-warning">Ariza topshirilmagan</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bd-dashboard-inner">
        <div class="bd-dashboard-reviews-wrapper">
            <div class="bd-dashboard-review-item mb-30">
                <h5 class="title underline"><a href="{% url 'dashboard:abituriyent_passport' %}">Passport
                    ma'lumotlari</a></h5>
                <div class="course-info d-flex align-content-center justify-content-between flex-wrap gap-2 mb-10">
                    <div class="bd-course-rating-wrap d-flex align-items-center gap-10">
                        <div class="bd-course-rating-text">
                            {% if profile %}
                            <span>{{ profile.get_full_name }}</span>
                            {% else %}
                            <span class="text-warning">Passport ma'lumotlari kiritilmagan</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="bd-button-action">
                        <a class="bd-default-tooltip view" href="{% url 'dashboard:abituriyent_passport' %}"><span><i
                                class="fas fa-arrow-right"></i></span></a>
                    </div>
                </div>
            </div>

            <div class="bd-dashboard-review-item mb-30">
                {% if user.diplom or user.transfer_diplom %}
                <!-- Mavjud diplom ma'lumotlari -->
                {% if user.diplom %}
                <h5 class="title underline">
                    <a href="{% url 'dashboard:abituriyent_diplom' %}">Diplom ma'lumotlari</a>
                </h5>
                <div class="course-info d-flex align-content-center justify-content-between flex-wrap gap-2 mb-10">
                    <div class="bd-course-rating-wrap d-flex align-items-center gap-10">
                        <div class="bd-course-rating-text">
                            <span><strong>{{ user.diplom.university_name }}</strong></span>
                            <br>
                            <small class="text-muted">
                                {{ user.diplom.education_type.name }} • {{ user.diplom.graduation_year }}-yil
                            </small>
                            <br>
                            <small class="text-success">
                                <i class="fas fa-check-circle me-1"></i>Yangi qabul
                            </small>
                        </div>
                    </div>
                    <div class="bd-button-action">
                        <a class="bd-default-tooltip view" href="{% url 'dashboard:abituriyent_diplom' %}"
                           title="Ko'rish va tahrirlash">
                            <span><i class="fas fa-arrow-right"></i></span>
                        </a>
                    </div>
                </div>
                {% elif user.transfer_diplom %}
                <h5 class="title underline">
                    <a href="{% url 'dashboard:abituriyent_transfer_diplom' %}">O'qishni ko'chirish ma'lumotlari</a>
                </h5>
                <div class="course-info d-flex align-content-center justify-content-between flex-wrap gap-2 mb-10">
                    <div class="bd-course-rating-wrap d-flex align-items-center gap-10">
                        <div class="bd-course-rating-text">
                            <span><strong>{{ user.transfer_diplom.university_name }}</strong></span>
                            <br>
                            <small class="text-muted">
                                {{ user.transfer_diplom.country.name }} • {{ user.transfer_diplom.target_course.name }}
                            </small>
                            <br>
                            <small class="text-info">
                                <i class="fas fa-exchange-alt me-1"></i>O'qishni ko'chirish
                            </small>
                        </div>
                    </div>
                    <div class="bd-button-action">
                        <a class="bd-default-tooltip view" href="{% url 'dashboard:abituriyent_transfer_diplom' %}"
                           title="Ko'rish va tahrirlash">
                            <span><i class="fas fa-arrow-right"></i></span>
                        </a>
                    </div>
                </div>
                {% endif %}
                {% else %}
                <!-- Diplom ma'lumotlari yo'q -->
                <h5 class="title underline">
                    <a href="{% url 'dashboard:abituriyent_diplom' %}">Diplom ma'lumotlari</a>
                </h5>
                <div class="course-info d-flex align-content-center justify-content-between flex-wrap gap-2 mb-10">
                    <div class="bd-course-rating-wrap d-flex align-items-center gap-10">
                        <div class="bd-course-rating-text">
                    <span class="text-warning">
                        <i class="fas fa-exclamation-triangle me-1"></i>Diplom ma'lumotlari topilmadi
                    </span>
                            <br>
                            <small class="text-muted">Ma'lumotlaringizni kiriting</small>
                        </div>
                    </div>
                    <div class="bd-button-action d-flex gap-2">
                        <a class="bd-default-tooltip" href="{% url 'dashboard:abituriyent_diplom' %}"
                           title="Yangi qabul">
                    <span class="badge bg-primary">
                        <i class="fas fa-plus me-1"></i>Yangi
                    </span>
                        </a>
                        <a class="bd-default-tooltip" href="{% url 'dashboard:abituriyent_transfer_diplom' %}"
                           title="O'qishni ko'chirish">
                    <span class="badge bg-info">
                        <i class="fas fa-exchange-alt me-1"></i>Ko'chirish
                    </span>
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="bd-dashboard-review-item mb-30">
                <h5 class="title underline"><a href="{% url 'dashboard:abituriyent_apply' %}">Ariza holati</a></h5>
                <div class="course-info d-flex align-content-center justify-content-between flex-wrap gap-2 mb-10">
                    <div class="bd-course-rating-wrap d-flex align-items-center gap-10">
                        <div class="bd-course-rating-text">
                            {% if user.application %}
                                <span><strong>{{ user.application.program.name }}</strong></span>
                                <br>
                                <small class="text-muted">
                                    {{ user.application.branch.name }} • {{ user.application.get_admission_type_display }}
                                </small>
                                <br>
                                <!-- Ariza holati badge -->
                                {% if user.application.status == 'qabul_qilindi' %}
                                    <span class="badge bg-success">
                                        <i class="fas fa-check-circle me-1"></i>Qabul qilindi
                                    </span>
                                {% elif user.application.status == 'korib_chiqilmoqda' %}
                                    <span class="badge bg-info">
                                        <i class="fas fa-clock me-1"></i>Ko'rib chiqilmoqda
                                    </span>
                                {% elif user.application.status == 'topshirildi' %}
                                    <span class="badge bg-warning">
                                        <i class="fas fa-file-alt me-1"></i>Topshirildi
                                    </span>
                                {% else %}
                                    <span class="badge bg-secondary">
                                        <i class="fas fa-question-circle me-1"></i>{{ user.application.get_status_display }}
                                    </span>
                                {% endif %}
                            {% else %}
                                <span class="text-warning">Ariza topshirilmagan</span>
                                <br>
                                <small class="text-muted">Yo'nalishga ariza topshiring</small>
                            {% endif %}
                        </div>
                    </div>
                    <div class="bd-button-action">
                        <a class="bd-default-tooltip view" href="{% url 'dashboard:abituriyent_apply' %}">
                            <span><i class="fas fa-arrow-right"></i></span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Test natijalari qismi - Faqat ariza mavjud bo'lsa va test ma'lumotlari bo'lsa -->
            {% if user.application and user.application.test_completed is not None %}
            <div class="bd-dashboard-review-item mb-30">
                <h5 class="title underline">
                    <a href="#">Test natijalari</a>
                </h5>
                <div class="course-info d-flex align-content-center justify-content-between flex-wrap gap-2 mb-10">
                    <div class="bd-course-rating-wrap d-flex align-items-center gap-10">
                        <div class="bd-course-rating-text">
                            {% if user.application.test_completed %}
                                <span><strong>{{ user.application.test_score|default:"0" }} ball</strong></span>
                                <br>
                                <!-- Test sanasi -->
                                {% if user.application.test_date %}
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>{{ user.application.test_date|date:"d.m.Y" }}
                                </small>
                                <br>
                                {% endif %}
                                <!-- Test holati -->
                                {% if user.application.test_passed %}
                                    <span class="badge bg-success">
                                        <i class="fas fa-check-circle me-1"></i>Test o'tdi
                                    </span>
                                {% elif user.application.test_passed == False %}
                                    <span class="badge bg-danger">
                                        <i class="fas fa-times-circle me-1"></i>Test o'tmadi
                                    </span>
                                {% else %}
                                    <span class="badge bg-info">
                                        <i class="fas fa-clock me-1"></i>Natija kutilmoqda
                                    </span>
                                {% endif %}
                            {% elif user.application.test_completed == False %}
                                <span class="text-warning">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Test topshirilmagan
                                </span>
                                <br>
                                <small class="text-muted">Test topshirish uchun bog'laning</small>
                            {% else %}
                                <span class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>Test ma'lumotlari yo'q
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="bd-button-action">
                        <a class="bd-default-tooltip view" href="#" 
                           title="Batafsil natijalarni ko'rish">
                            <span><i class="fas fa-arrow-right"></i></span>
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

        </div>
    </div>
</div>

<!-- Test natijasi modal oynasi (ixtiyoriy - batafsil ko'rish uchun) -->
{% if user.application and user.application.test_completed and user.application.test_score %}
<div class="modal fade" id="testResultModal" tabindex="-1" aria-labelledby="testResultModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="testResultModalLabel">
                    <i class="fas fa-chart-line me-2"></i>Test natijalari
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center">
                                <h2 class="{% if user.application.test_passed %}text-success{% else %}text-danger{% endif %}">
                                    {{ user.application.test_score|default:"0" }}/100
                                </h2>
                                <p class="mb-0">Jami ball</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center">
                                {% if user.application.test_passed %}
                                <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
                                <p class="text-success mb-0"><strong>O'tdi</strong></p>
                                {% elif user.application.test_passed == False %}
                                <i class="fas fa-times-circle text-danger fa-2x mb-2"></i>
                                <p class="text-danger mb-0"><strong>O'tmadi</strong></p>
                                {% else %}
                                <i class="fas fa-clock text-warning fa-2x mb-2"></i>
                                <p class="text-warning mb-0"><strong>Kutilmoqda</strong></p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% if user.application.test_date %}
                <hr>
                <div class="text-center">
                    <small class="text-muted">
                        <i class="fas fa-calendar me-1"></i>
                        Test sanasi: {{ user.application.test_date|date:"d F Y, H:i" }}
                    </small>
                </div>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                <a href="#" class="btn btn-primary">
                    <i class="fas fa-eye me-1"></i>Batafsil ko'rish
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal ochish uchun tugma (agar kerak bo'lsa) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Test natijasini ko'rsatish uchun JavaScript kodi
    const testSection = document.querySelector('.test-results-section');
    if (testSection) {
        testSection.addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('testResultModal'));
            modal.show();
        });
    }
});
</script>
{% endif %}

{% endblock main_content %}
